#!/usr/bin/env perl

BEGIN { use lib 't'; require 'testlib.pl'; }

use Modern::Perl;

# not16 - error no arguments
spew("$test.in", "not16");
capture_nok("bfpp $test.in", <<END);
$test.in:1:6: error: expected '(' after macro name 'not16'
END

# not16 - error empty arguments
spew("$test.in", "not16()");
capture_nok("bfpp $test.in", <<END);
$test.in:1:8: error: macro 'not16' expects 1 argument
END

# not16 - error too many arguments
spew("$test.in", "not16(A,B");
capture_nok("bfpp $test.in", <<END);
$test.in:1:8: error: expected ')' at end of macro call, found ','
END

# not16 - negate the cell value
spew("$test.in", "alloc_cell16(X) not16(X)");
capture_ok("bfpp $test.in", <<END);
[
  -
]
>
[
  -
]
>
[
  -
]
>
[
  -
]
>
[
  -
]
<<
[
  -
]
<<
[
  ->>+>>+<<<<
]
>>>>
[
  -<<<<+>>>>
]
[
  -
]
[
  -
]
>
[
  -
]
<
[
  -
]
<<
[
  ->>+<<
]
+>>>+<
[
  ->
  [
    -<<<->>>
  ]
  <
]
[
  -
]
>
[
  -
]
<
[
  -
]
<
[
  -
]
<<
[
  ->>+>+<<<
]
>>>
[
  -<<<+>>>
]
[
  -
]
[
  -
]
>
[
  -
]
<
[
  -
]
<
[
  ->+<
]
+>>+<
[
  ->
  [
    -<<->>
  ]
  <
]
[
  -
]
>
[
  -
]
<
[
  -
]
>
[
  -
]
>
[
  -
]
<<
[
  -
]
<<
[
  ->>+<<
]
>>>>>
[
  -
]
>
[
  -
]
<
[
  -
]
<<<
[
  ->>>+<<<
]
+>>>>+<
[
  ->
  [
    -<<<<->>>>
  ]
  <
]
[
  -
]
>
[
  -
]
<
[
  -
]
>
[
  -
]
<
[
  -
]
<<<
[
  ->>>+<<<
]
+>>>>+<
[
  ->
  [
    -<<<<->>>>
  ]
  <
]
[
  -
]
>
[
  -
]
<
[
  -
]
<<
[
  -
]
<<
[
  ->>+>>+<<<<
]
>>>>
[
  -<<<<+>>>>
]
[
  -
]
[
  -
]
>
[
  -
]
<
[
  -
]
<<
[
  ->>+<<
]
+>>>+<
[
  ->
  [
    -<<<->>>
  ]
  <
]
[
  -
]
>
[
  -
]
<
[
  -
]
>
[
  -
]
<
[
  -
]
<<
[
  ->>+<<
]
+>>>+<
[
  ->
  [
    -<<<->>>
  ]
  <
]
[
  -
]
>
[
  -
]
<<<<
[
  ->>
  [
    -
  ]
  <
  [
    ->+<
  ]
  <
]
<<
[
  -
]
>>>>
[
  -<<<<+>>>>
]
<<
[
  -
]
>
[
  -
]
>
[
  -
]
<<
[
  -
]
>
[
  -
]
>
[
  -
]
<
[
  -
]
<<<
[
  ->>>+>+<<<<
]
>>>>
[
  -<<<<+>>>>
]
[
  -
]
[
  -
]
>
[
  -
]
<
[
  -
]
<
[
  ->+<
]
+>>+<
[
  ->
  [
    -<<->>
  ]
  <
]
[
  -
]
>
[
  -
]
<
[
  -
]
<<
[
  -
]
>
[
  -<+>>+<
]
>
[
  -<+>
]
[
  -
]
[
  -
]
>
[
  -
]
<
[
  -
]
<<
[
  ->>+<<
]
+>>>+<
[
  ->
  [
    -<<<->>>
  ]
  <
]
[
  -
]
>
[
  -
]
<<<
[
  <<<<
  [
    -
  ]
  +>
  [
    -
  ]
  >>>-
]
>
[
  <<<<<
  [
    -
  ]
  >
  [
    -
  ]
  >>>>-
]
<
[
  -
]
>
[
  -
]
<<<
[
  -
]
>
[
  -
]
<<<
END

# not16 - execute a test program
spew("$test.in", "alloc_cell16(X) clear16(X) not16(X) >1");
capture_ok("bfpp $test.in | bf -D", <<END);
Tape:  1   0 
         ^^^ (ptr=1)

END

for my $i (1, 2, 254, 255, 256, 511) {
	spew("$test.in", "alloc_cell16(X) set16(X, $i) not16(X) >1");
	capture_ok("bfpp $test.in | bf -D", <<END);
Tape:  0   0 
         ^^^ (ptr=1)

END
}

unlink_testfiles;
done_testing;
