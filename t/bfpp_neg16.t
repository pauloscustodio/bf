#!/usr/bin/env perl

BEGIN { use lib 't'; require 'testlib.pl'; }

use Modern::Perl;

# neg16 - error no arguments
spew("$test.in", "neg16");
capture_nok("bfpp $test.in", <<END);
$test.in:1:6: error: expected '(' after macro name 'neg16'
END

# neg16 - error empty arguments
spew("$test.in", "neg16()");
capture_nok("bfpp $test.in", <<END);
$test.in:1:8: error: macro 'neg16' expects 1 argument
END

# neg16 - error too many arguments
spew("$test.in", "neg16(A,B");
capture_nok("bfpp $test.in", <<END);
$test.in:1:8: error: expected ')' at end of macro call, found ','
END

# neg16 - negate the cell value
spew("$test.in", "alloc_cell16(X) neg16(X)");
capture_ok("bfpp $test.in", <<END);
[ Generated by bfpp, see https://github.com/pauloscustodio/bf
  2163 instructions, 16 tape cells
]
[-]>[-]>[-]>[-]>[-]>[-]>[-]<<[-]<<[->>+>>+<<<<]>>>>[-<<<<+>>>>][-]>[-]<[-]<<<<<<
[->>>>>>+>+<<<<<<<]>>>>>>>[-<<<<<<<+>>>>>>>][-]<[-<<<<->>>>][-]<[-]<<<[->>>+>+<<
<<]>>>>[-<<<<+>>>>][-]>[-]>[-]>[-]>[-]<<<<[-]<[->+>>>>+<<<<<]>>>>>[-<<<<<+>>>>>]
[-]<<<[-]<<<[->>>+>>>+<<<<<<]>>>>>>[-<<<<<<+>>>>>>][-]<<[-]<<[->>+>>+<<<<]>>>>[-
<<<<+>>>>][-]>[-]>[-]<<[-]<<[->>+<<]>>>>>[-]>[-]<[-]<<<[->>>+<<<]+>>>>+<[->[-<<<
<->>>>]<][-]>[-]<[-]>[-]<[-]<<<[->>>+<<<]+>>>>+<[->[-<<<<->>>>]<][-]>[-]<[-]<<[-
]<<<<[->>>>+>>+<<<<<<]>>>>>>[-<<<<<<+>>>>>>][-]>[-]<[-]<<[->>+<<]+>>>+<[->[-<<<-
>>>]<][-]>[-]<[-]>[-]<[-]<<[->>+<<]+>>>+<[->[-<<<->>>]<][-]>[-]<<<<[->>[-]<[->+<
]<]<<[-]>>>>[-<<<<+>>>>]<<[-]>[-]>[-]<<[-]>[-]<[-]<<[->>+>+<<<]>>>[-<<<+>>>][-]>
[-]<[-]<[->+<]+>>+<[->[-<<->>]<][-]>[-]<[-]>[-]<[-]<[->+<]+>>+<[->[-<<->>]<][-]>
[-]<<[<<<<->->>>>[-]<<<[-]<<[->>+>>>+<<<<<]>>>>>[-<<<<<+>>>>>][-]>[-]>[-]<<[-]<<
<[->>>+<<<]>>>>>>[-]>[-]<[-]<<<[->>>+<<<]+>>>>+<[->[-<<<<->>>>]<][-]>[-]<[-]>[-]
<[-]<<<[->>>+<<<]+>>>>+<[->[-<<<<->>>>]<][-]>[-]<[-]<<[-]<<<<<[->>>>>+>>+<<<<<<<
]>>>>>>>[-<<<<<<<+>>>>>>>][-]>[-]<[-]<<[->>+<<]+>>>+<[->[-<<<->>>]<][-]>[-]<[-]>
[-]<[-]<<[->>+<<]+>>>+<[->[-<<<->>>]<][-]>[-]<<<<[->>[-]<[->+<]<]<<<[-]>>>>>[-<<
<<<+>>>>>]<<[-]>[-]>[-]<<[-]<[-]<<[->>+>+<<<]>>>[-<<<+>>>][-]>[-]<[-]<[->+<]+>>+
<[->[-<<->>]<][-]>[-]<[-]>[-]<[-]<[->+<]+>>+<[->[-<<->>]<][-]>[-]<<][-]<<<<<[-]>
>>>>[-]<[-]<<[->>+>+<<<]>>>[-<<<+>>>][-]>[-]<[-]<[->+<]+>>+<[->[-<<->>]<][-]>[-]
<[-]>[-]>[-]<<[-]<[->+<]>>>>[-]>[-]<[-]<<<[->>>+<<<]+>>>>+<[->[-<<<<->>>>]<][-]>
[-]<[-]>[-]<[-]<<<[->>>+<<<]+>>>>+<[->[-<<<<->>>>]<][-]>[-]<[-]<<[-]<<<<<[->>>>>
+>>+<<<<<<<]>>>>>>>[-<<<<<<<+>>>>>>>][-]>[-]<[-]<<[->>+<<]+>>>+<[->[-<<<->>>]<][
-]>[-]<[-]>[-]<[-]<<[->>+<<]+>>>+<[->[-<<<->>>]<][-]>[-]<<<<[->>[-]<[->+<]<]<[-]
>>>[-<<<+>>>]<<[-]>[-]>[-]<<[-]>[-]>[-]<[-]<<[->>+>+<<<]>>>[-<<<+>>>][-]>[-]<[-]
<[->+<]+>>+<[->[-<<->>]<][-]>[-]<[-]<<[-]>[-<+>>+<]>[-<+>][-]>[-]<[-]<<[->>+<<]+
>>>+<[->[-<<<->>>]<][-]>[-]<<<[<<<<<+>>>>>-][-]>[-]<<<<<[-]>[-]>[-]>[-]<<<[-]>[-
]<[-]<<<<<[->>>>>+>+<<<<<<]>>>>>>[-<<<<<<+>>>>>>][-]<[-<<<->>>][-]>[-]<[-]<[->+>
+<<]>>[-<<+>>][-]<[-<<<->>>][-]<<[-]>[-]<<<<<[-]>>[-<<+>>]<[-]>>[-<<+>>]<[-]>[-]
<<<
END

# neg16 - execute a test program
for my $A (0, 1, 2, 32767, 32768, 65535) {
	spew("$test.in", "alloc_cell16(X) set16(X, $A) neg16(X) >(X+1)");
	my $R = (-$A) & 0xFFFF;
	my $Rlo = sprintf("%3d", $R & 0xFF);
	my $Rhi = sprintf("%3d", ($R >> 8) & 0xFF);
	capture_ok("bfpp $test.in | bf -D", <<END);
Tape:$Rlo $Rhi 
         ^^^ (ptr=1)

END
}

unlink_testfiles;
done_testing;
