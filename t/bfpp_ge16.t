#!/usr/bin/env perl

BEGIN { use lib 't'; require 'testlib.pl'; }

use Modern::Perl;

# ge16 - error no arguments
spew("$test.in", "ge16");
capture_nok("bfpp $test.in", <<END);
$test.in:1:5: error: expected '(' after macro name 'ge16'
END

# ge16 - error empty arguments
spew("$test.in", "ge16()");
capture_nok("bfpp $test.in", <<END);
$test.in:1:7: error: macro 'ge16' expects 2 arguments
END

# ge16 - error too many arguments
spew("$test.in", "ge16(A,B,C)");
capture_nok("bfpp $test.in", <<END);
$test.in:1:9: error: expected ')' at end of macro call, found ','
END

# ge16(a,b)
spew("$test.in", <<END);
alloc_cell16(A)
alloc_cell16(B)
ge16(A,B)
END
capture_ok("bfpp $test.in", <<END);
[ Generated by bfpp, see https://github.com/pauloscustodio/bf
  5156 instructions, 18 tape cells
]
[-]>[-]>[-]>[-]>[-]>[-]>[-]<<[-]<<<[->>>+>>+<<<<<]>>>>>[-<<<<<+>>>>>][-]>[-]>[-]
>[-]>[-]<<<<[-]<<[->>+>>>>+<<<<<<]>>>>>>[-<<<<<<+>>>>>>][-]<<<[-]<<<<[->>>>+>>>+
<<<<<<<]>>>>>>>[-<<<<<<<+>>>>>>>][-]<<[-]<<[->>+>>+<<<<]>>>>[-<<<<+>>>>][-]>[-]>
[-]<<[-]<<[->>+<<]>>>>>[-]>[-]<[-]<<<[->>>+<<<]+>>>>+<[->[-<<<<->>>>]<][-]>[-]<[
-]>[-]<[-]<<<[->>>+<<<]+>>>>+<[->[-<<<<->>>>]<][-]>[-]<[-]<<[-]<<<<[->>>>+>>+<<<
<<<]>>>>>>[-<<<<<<+>>>>>>][-]>[-]<[-]<<[->>+<<]+>>>+<[->[-<<<->>>]<][-]>[-]<[-]>
[-]<[-]<<[->>+<<]+>>>+<[->[-<<<->>>]<][-]>[-]<<<<[->>[-]<[->+<]<]<<[-]>>>>[-<<<<
+>>>>]<<[-]>[-]>[-]<<[-]>[-]<[-]<<[->>+>+<<<]>>>[-<<<+>>>][-]>[-]<[-]<[->+<]+>>+
<[->[-<<->>]<][-]>[-]<[-]>[-]<[-]<[->+<]+>>+<[->[-<<->>]<][-]>[-]<<[<<<<->->>>>[
-]<<<[-]<<[->>+>>>+<<<<<]>>>>>[-<<<<<+>>>>>][-]>[-]>[-]<<[-]<<<[->>>+<<<]>>>>>>[
-]>[-]<[-]<<<[->>>+<<<]+>>>>+<[->[-<<<<->>>>]<][-]>[-]<[-]>[-]<[-]<<<[->>>+<<<]+
>>>>+<[->[-<<<<->>>>]<][-]>[-]<[-]<<[-]<<<<<[->>>>>+>>+<<<<<<<]>>>>>>>[-<<<<<<<+
>>>>>>>][-]>[-]<[-]<<[->>+<<]+>>>+<[->[-<<<->>>]<][-]>[-]<[-]>[-]<[-]<<[->>+<<]+
>>>+<[->[-<<<->>>]<][-]>[-]<<<<[->>[-]<[->+<]<]<<<[-]>>>>>[-<<<<<+>>>>>]<<[-]>[-
]>[-]<<[-]<[-]<<[->>+>+<<<]>>>[-<<<+>>>][-]>[-]<[-]<[->+<]+>>+<[->[-<<->>]<][-]>
[-]<[-]>[-]<[-]<[->+<]+>>+<[->[-<<->>]<][-]>[-]<<][-]<<<<<<[-]>>>>>>[-]<[-]<<<[-
>>>+>+<<<<]>>>>[-<<<<+>>>>][-]>[-]<[-]<[->+<]+>>+<[->[-<<->>]<][-]>[-]<[-]>[-]>[
-]<<[-]<[->+<]>>>>[-]>[-]<[-]<<<[->>>+<<<]+>>>>+<[->[-<<<<->>>>]<][-]>[-]<[-]>[-
]<[-]<<<[->>>+<<<]+>>>>+<[->[-<<<<->>>>]<][-]>[-]<[-]<<[-]<<<<[->>>>+>>+<<<<<<]>
>>>>>[-<<<<<<+>>>>>>][-]>[-]<[-]<<[->>+<<]+>>>+<[->[-<<<->>>]<][-]>[-]<[-]>[-]<[
-]<<[->>+<<]+>>>+<[->[-<<<->>>]<][-]>[-]<<<<[->>[-]<[->+<]<]<[-]>>>[-<<<+>>>]<<[
-]>[-]>[-]<<[-]>[-]>[-]<[-]<<[->>+>+<<<]>>>[-<<<+>>>][-]>[-]<[-]<[->+<]+>>+<[->[
-<<->>]<][-]>[-]<[-]<<[-]>[-<+>>+<]>[-<+>][-]>[-]<[-]<<[->>+<<]+>>>+<[->[-<<<->>
>]<][-]>[-]<<<[<<<<<<+>>>>>>-][-]>[-]<<<<<[-]>[-]>[-]>[-]<<<[-]<[-]<<<<[->>>>+>+
<<<<<]>>>>>[-<<<<<+>>>>>][-]>[-]<[-]<<<[->>>+>+<<<<]>>>>[-<<<<+>>>>][-]<[-<->][-
]>[-]<[-]<[->+<]+>>+<[->[-<<->>]<][-]>[-]<[-]>[-]>[-]<[-]<<[->>+>+<<<]>>>[-<<<+>
>>][-]>[-]<[-]<[->+<]+>>+<[->[-<<->>]<][-]>[-]<[-]<<[-]>[-<+>>+<]>[-<+>][-]>[-]<
[-]<<[->>+<<]+>>>+<[->[-<<<->>>]<][-]>[-]<<<[>>[-]<<<<[-]<<<<[->>>>+>>>>+<<<<<<<
<]>>>>>>>>[-<<<<<<<<+>>>>>>>>][-]>[-]>[-]>[-]>[-]<<<<[-]<<<<[->>>>+>>>>+<<<<<<<<
]>>>>>>>>[-<<<<<<<<+>>>>>>>>][-]<<<[-]<<<<<<<[->>>>>>>+>>>+<<<<<<<<<<]>>>>>>>>>>
[-<<<<<<<<<<+>>>>>>>>>>][-]<<[-]<<[->>+>>+<<<<]>>>>[-<<<<+>>>>][-]>[-]>[-]<<[-]<
<[->>+<<]>>>>>[-]>[-]<[-]<<<[->>>+<<<]+>>>>+<[->[-<<<<->>>>]<][-]>[-]<[-]>[-]<[-
]<<<[->>>+<<<]+>>>>+<[->[-<<<<->>>>]<][-]>[-]<[-]<<[-]<<<<[->>>>+>>+<<<<<<]>>>>>
>[-<<<<<<+>>>>>>][-]>[-]<[-]<<[->>+<<]+>>>+<[->[-<<<->>>]<][-]>[-]<[-]>[-]<[-]<<
[->>+<<]+>>>+<[->[-<<<->>>]<][-]>[-]<<<<[->>[-]<[->+<]<]<<[-]>>>>[-<<<<+>>>>]<<[
-]>[-]>[-]<<[-]>[-]<[-]<<[->>+>+<<<]>>>[-<<<+>>>][-]>[-]<[-]<[->+<]+>>+<[->[-<<-
>>]<][-]>[-]<[-]>[-]<[-]<[->+<]+>>+<[->[-<<->>]<][-]>[-]<<[<<<<->->>>>[-]<<<[-]<
<[->>+>>>+<<<<<]>>>>>[-<<<<<+>>>>>][-]>[-]>[-]<<[-]<<<[->>>+<<<]>>>>>>[-]>[-]<[-
]<<<[->>>+<<<]+>>>>+<[->[-<<<<->>>>]<][-]>[-]<[-]>[-]<[-]<<<[->>>+<<<]+>>>>+<[->
[-<<<<->>>>]<][-]>[-]<[-]<<[-]<<<<<[->>>>>+>>+<<<<<<<]>>>>>>>[-<<<<<<<+>>>>>>>][
-]>[-]<[-]<<[->>+<<]+>>>+<[->[-<<<->>>]<][-]>[-]<[-]>[-]<[-]<<[->>+<<]+>>>+<[->[
-<<<->>>]<][-]>[-]<<<<[->>[-]<[->+<]<]<<<[-]>>>>>[-<<<<<+>>>>>]<<[-]>[-]>[-]<<[-
]<[-]<<[->>+>+<<<]>>>[-<<<+>>>][-]>[-]<[-]<[->+<]+>>+<[->[-<<->>]<][-]>[-]<[-]>[
-]<[-]<[->+<]+>>+<[->[-<<->>]<][-]>[-]<<][-]<<<<<<<<[-]>>>>>>>>[-]<[-]<<<[->>>+>
+<<<<]>>>>[-<<<<+>>>>][-]>[-]<[-]<[->+<]+>>+<[->[-<<->>]<][-]>[-]<[-]>[-]>[-]<<[
-]<[->+<]>>>>[-]>[-]<[-]<<<[->>>+<<<]+>>>>+<[->[-<<<<->>>>]<][-]>[-]<[-]>[-]<[-]
<<<[->>>+<<<]+>>>>+<[->[-<<<<->>>>]<][-]>[-]<[-]<<[-]<<<<[->>>>+>>+<<<<<<]>>>>>>
[-<<<<<<+>>>>>>][-]>[-]<[-]<<[->>+<<]+>>>+<[->[-<<<->>>]<][-]>[-]<[-]>[-]<[-]<<[
->>+<<]+>>>+<[->[-<<<->>>]<][-]>[-]<<<<[->>[-]<[->+<]<]<[-]>>>[-<<<+>>>]<<[-]>[-
]>[-]<<[-]>[-]>[-]<[-]<<[->>+>+<<<]>>>[-<<<+>>>][-]>[-]<[-]<[->+<]+>>+<[->[-<<->
>]<][-]>[-]<[-]<<[-]>[-<+>>+<]>[-<+>][-]>[-]<[-]<<[->>+<<]+>>>+<[->[-<<<->>>]<][
-]>[-]<<<[<<<<<<<<+>>>>>>>>-][-]>[-]<<<<<[-]>[-]>[-]>[-]<<<<<-][-]>[-]<[-]>[-]>[
-]<[-]<<<[->>>+>+<<<<]>>>>[-<<<<+>>>>][-]>[-]<[-]<[->+<]+>>+<[->[-<<->>]<][-]>[-
]<[-]<<[-]>[-<+>>+<]>[-<+>][-]>[-]<[-]<<[->>+<<]+>>>+<[->[-<<<->>>]<][-]>[-]<<<[
<<<<<<[-]+>[-]>>>>>-]>[<<<<<<<[-]>[-]>>>>>>-]<[-]>[-]<<<[-]>[-]<[-]>[-]>[-]<<[-]
<<<<[->>>>+>>+<<<<<<]>>>>>>[-<<<<<<+>>>>>>][-]>[-]<[-]<<[->>+<<]+>>>+<[->[-<<<->
>>]<][-]>[-]<[-]<[-]<<<<[->>>>+>+<<<<<]>>>>>[-<<<<<+>>>>>][-]>[-]<[-]<[->+<]+>>+
<[->[-<<->>]<][-]>[-]<[-]>[-]>[-]<<[-]<<[->>+<<]>>>>>[-]>[-]<[-]<<<[->>>+<<<]+>>
>>+<[->[-<<<<->>>>]<][-]>[-]<[-]>[-]<[-]<<<[->>>+<<<]+>>>>+<[->[-<<<<->>>>]<][-]
>[-]<[-]<<[-]<<[->>+>>+<<<<]>>>>[-<<<<+>>>>][-]>[-]<[-]<<[->>+<<]+>>>+<[->[-<<<-
>>>]<][-]>[-]<[-]>[-]<[-]<<[->>+<<]+>>>+<[->[-<<<->>>]<][-]>[-]<<<<[->>[-]<[->+<
]<]<<[-]>>>>[-<<<<+>>>>]<<[-]>[-]>[-]<<[-]>[-]>[-]<[-]<<<[->>>+>+<<<<]>>>>[-<<<<
+>>>>][-]>[-]<[-]<[->+<]+>>+<[->[-<<->>]<][-]>[-]<[-]<<[-]>[-<+>>+<]>[-<+>][-]>[
-]<[-]<<[->>+<<]+>>>+<[->[-<<<->>>]<][-]>[-]<<<[<<<<<<[-]+>[-]>>>>>-]>[<<<<<<<[-
]>[-]>>>>>>-]<[-]>[-]<<<[-]>[-]<<<<<
END

# run ge16(a,b)
for my $A (0, 1, 2, 256, 511, 1023, 30000, 40000, 65535) {
	for my $B (0, 1, 2, 256, 511, 1023, 30000, 40000, 65535) {
		spew("$test.in", <<END);
		alloc_cell16(A)
		alloc_cell16(B)
		set16(A, $A)
		set16(B, $B)
		ge16(A, B)
		>(B+1)
END
		my $R = ($A >= $B) ? 1 : 0;
		my $Rlo = sprintf("%3d", $R & 0xFF);
		my $Rhi = sprintf("%3d", ($R >> 8) & 0xFF);
		my $Blo = sprintf("%3d", $B & 0xFF);
		my $Bhi = sprintf("%3d", ($B >> 8) & 0xFF);
		capture_ok("bfpp $test.in | bf -D", <<END);
Tape:$Rlo $Rhi $Blo $Bhi 
                 ^^^ (ptr=3)

END
	}
}

unlink_testfiles;
done_testing;
