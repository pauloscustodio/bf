#!/usr/bin/env perl

BEGIN { use lib 't'; require 'testlib.pl'; }

use Modern::Perl;

# scan_spaces - read chars until non-space
spew("$test.in", <<END);
alloc_cell8(C)
scan_spaces
scan_char8(C)
END
capture_ok("bfpp $test.in", <<END);
[ Generated by bfpp, see https://github.com/pauloscustodio/bf
  4908 instructions, 16 tape cells
]
[-]>[-]>[-]>[-]++++++++++++++++++++++++++++++++>>[-]>[-]>[-]<[-]<<[->>+>+<<<]>>>
[-<<<+>>>][-]>[-]<[-]<[->+<]+>>+<[->[-<<->>]<][-]>[-]<[-]<<[-]>[-<+>>+<]>[-<+>][
-]>[-]<[-]<<[->>+<<]+>>>+<[->[-<<<->>>]<][-]>[-]<<<[<<<<[-]>>>[-<<<+>>>]>-]>[<<<
<<,>>>>>-]<[-]>[-]<[-]<<<[-]<[->+>>>+<<<<]>>>>[-<<<<+>>>>][-]>[-]>[-]>[-]>[-]<<<
<[-]<<<[->>>+>>>>+<<<<<<<]>>>>>>>[-<<<<<<<+>>>>>>>][-]<<<[-]<<<[->>>+>>>+<<<<<<]
>>>>>>[-<<<<<<+>>>>>>][-]<<[-]<<[->>+>>+<<<<]>>>>[-<<<<+>>>>][-]>[-]>[-]<<[-]<<[
->>+<<]>>>>>[-]>[-]<[-]<<<[->>>+<<<]+>>>>+<[->[-<<<<->>>>]<][-]>[-]<[-]>[-]<[-]<
<<[->>>+<<<]+>>>>+<[->[-<<<<->>>>]<][-]>[-]<[-]<<[-]<<<<[->>>>+>>+<<<<<<]>>>>>>[
-<<<<<<+>>>>>>][-]>[-]<[-]<<[->>+<<]+>>>+<[->[-<<<->>>]<][-]>[-]<[-]>[-]<[-]<<[-
>>+<<]+>>>+<[->[-<<<->>>]<][-]>[-]<<<<[->>[-]<[->+<]<]<<[-]>>>>[-<<<<+>>>>]<<[-]
>[-]>[-]<<[-]>[-]<[-]<<[->>+>+<<<]>>>[-<<<+>>>][-]>[-]<[-]<[->+<]+>>+<[->[-<<->>
]<][-]>[-]<[-]>[-]<[-]<[->+<]+>>+<[->[-<<->>]<][-]>[-]<<[<<<<->->>>>[-]<<<[-]<<[
->>+>>>+<<<<<]>>>>>[-<<<<<+>>>>>][-]>[-]>[-]<<[-]<<<[->>>+<<<]>>>>>>[-]>[-]<[-]<
<<[->>>+<<<]+>>>>+<[->[-<<<<->>>>]<][-]>[-]<[-]>[-]<[-]<<<[->>>+<<<]+>>>>+<[->[-
<<<<->>>>]<][-]>[-]<[-]<<[-]<<<<<[->>>>>+>>+<<<<<<<]>>>>>>>[-<<<<<<<+>>>>>>>][-]
>[-]<[-]<<[->>+<<]+>>>+<[->[-<<<->>>]<][-]>[-]<[-]>[-]<[-]<<[->>+<<]+>>>+<[->[-<
<<->>>]<][-]>[-]<<<<[->>[-]<[->+<]<]<<<[-]>>>>>[-<<<<<+>>>>>]<<[-]>[-]>[-]<<[-]<
[-]<<[->>+>+<<<]>>>[-<<<+>>>][-]>[-]<[-]<[->+<]+>>+<[->[-<<->>]<][-]>[-]<[-]>[-]
<[-]<[->+<]+>>+<[->[-<<->>]<][-]>[-]<<][-]<<<<<<<[-]>>>>>>>[-]<[-]<<[->>+>+<<<]>
>>[-<<<+>>>][-]>[-]<[-]<[->+<]+>>+<[->[-<<->>]<][-]>[-]<[-]>[-]>[-]<<[-]<[->+<]>
>>>[-]>[-]<[-]<<<[->>>+<<<]+>>>>+<[->[-<<<<->>>>]<][-]>[-]<[-]>[-]<[-]<<<[->>>+<
<<]+>>>>+<[->[-<<<<->>>>]<][-]>[-]<[-]<<[-]<<<<<[->>>>>+>>+<<<<<<<]>>>>>>>[-<<<<
<<<+>>>>>>>][-]>[-]<[-]<<[->>+<<]+>>>+<[->[-<<<->>>]<][-]>[-]<[-]>[-]<[-]<<[->>+
<<]+>>>+<[->[-<<<->>>]<][-]>[-]<<<<[->>[-]<[->+<]<]<[-]>>>[-<<<+>>>]<<[-]>[-]>[-
]<<[-]>[-]>[-]<[-]<<[->>+>+<<<]>>>[-<<<+>>>][-]>[-]<[-]<[->+<]+>>+<[->[-<<->>]<]
[-]>[-]<[-]<<[-]>[-<+>>+<]>[-<+>][-]>[-]<[-]<<[->>+<<]+>>>+<[->[-<<<->>>]<][-]>[
-]<<<[<<<<<<<+>>>>>>>-][-]>[-]<<<<<[-]>[-]>[-]>[-]<<<[-]>[-]<[-]<<<[->>>+<<<]+>>
>>+<[->[-<<<<->>>>]<][-]>[-]<[-]>[-]<[-]<<<[->>>+>+<<<<]>>>>[-<<<<+>>>>][-]>[-]<
[-]<[->+<]+>>+<[->[-<<->>]<][-]>[-]<[-]>[-]<[-]<[->+<]+>>+<[->[-<<->>]<][-]>[-]<
<[>[-]>[-]>[-]<[-]<<<[->>>+>+<<<<]>>>>[-<<<<+>>>>][-]>[-]<[-]<[->+<]+>>+<[->[-<<
->>]<][-]>[-]<[-]<<[-]>[-<+>>+<]>[-<+>][-]>[-]<[-]<<[->>+<<]+>>>+<[->[-<<<->>>]<
][-]>[-]<<<[<<<<<[-]>>>[-<<<+>>>]>>-]>[<<<<<<,>>>>>>-]<[-]>[-]<[-]<<<<[-]<[->+>>
>>+<<<<<]>>>>>[-<<<<<+>>>>>][-]>[-]>[-]>[-]>[-]<<<<[-]<<<<[->>>>+>>>>+<<<<<<<<]>
>>>>>>>[-<<<<<<<<+>>>>>>>>][-]<<<[-]<<<<[->>>>+>>>+<<<<<<<]>>>>>>>[-<<<<<<<+>>>>
>>>][-]<<[-]<<[->>+>>+<<<<]>>>>[-<<<<+>>>>][-]>[-]>[-]<<[-]<<[->>+<<]>>>>>[-]>[-
]<[-]<<<[->>>+<<<]+>>>>+<[->[-<<<<->>>>]<][-]>[-]<[-]>[-]<[-]<<<[->>>+<<<]+>>>>+
<[->[-<<<<->>>>]<][-]>[-]<[-]<<[-]<<<<[->>>>+>>+<<<<<<]>>>>>>[-<<<<<<+>>>>>>][-]
>[-]<[-]<<[->>+<<]+>>>+<[->[-<<<->>>]<][-]>[-]<[-]>[-]<[-]<<[->>+<<]+>>>+<[->[-<
<<->>>]<][-]>[-]<<<<[->>[-]<[->+<]<]<<[-]>>>>[-<<<<+>>>>]<<[-]>[-]>[-]<<[-]>[-]<
[-]<<[->>+>+<<<]>>>[-<<<+>>>][-]>[-]<[-]<[->+<]+>>+<[->[-<<->>]<][-]>[-]<[-]>[-]
<[-]<[->+<]+>>+<[->[-<<->>]<][-]>[-]<<[<<<<->->>>>[-]<<<[-]<<[->>+>>>+<<<<<]>>>>
>[-<<<<<+>>>>>][-]>[-]>[-]<<[-]<<<[->>>+<<<]>>>>>>[-]>[-]<[-]<<<[->>>+<<<]+>>>>+
<[->[-<<<<->>>>]<][-]>[-]<[-]>[-]<[-]<<<[->>>+<<<]+>>>>+<[->[-<<<<->>>>]<][-]>[-
]<[-]<<[-]<<<<<[->>>>>+>>+<<<<<<<]>>>>>>>[-<<<<<<<+>>>>>>>][-]>[-]<[-]<<[->>+<<]
+>>>+<[->[-<<<->>>]<][-]>[-]<[-]>[-]<[-]<<[->>+<<]+>>>+<[->[-<<<->>>]<][-]>[-]<<
<<[->>[-]<[->+<]<]<<<[-]>>>>>[-<<<<<+>>>>>]<<[-]>[-]>[-]<<[-]<[-]<<[->>+>+<<<]>>
>[-<<<+>>>][-]>[-]<[-]<[->+<]+>>+<[->[-<<->>]<][-]>[-]<[-]>[-]<[-]<[->+<]+>>+<[-
>[-<<->>]<][-]>[-]<<][-]<<<<<<<<[-]>>>>>>>>[-]<[-]<<[->>+>+<<<]>>>[-<<<+>>>][-]>
[-]<[-]<[->+<]+>>+<[->[-<<->>]<][-]>[-]<[-]>[-]>[-]<<[-]<[->+<]>>>>[-]>[-]<[-]<<
<[->>>+<<<]+>>>>+<[->[-<<<<->>>>]<][-]>[-]<[-]>[-]<[-]<<<[->>>+<<<]+>>>>+<[->[-<
<<<->>>>]<][-]>[-]<[-]<<[-]<<<<<[->>>>>+>>+<<<<<<<]>>>>>>>[-<<<<<<<+>>>>>>>][-]>
[-]<[-]<<[->>+<<]+>>>+<[->[-<<<->>>]<][-]>[-]<[-]>[-]<[-]<<[->>+<<]+>>>+<[->[-<<
<->>>]<][-]>[-]<<<<[->>[-]<[->+<]<]<[-]>>>[-<<<+>>>]<<[-]>[-]>[-]<<[-]>[-]>[-]<[
-]<<[->>+>+<<<]>>>[-<<<+>>>][-]>[-]<[-]<[->+<]+>>+<[->[-<<->>]<][-]>[-]<[-]<<[-]
>[-<+>>+<]>[-<+>][-]>[-]<[-]<<[->>+<<]+>>>+<[->[-<<<->>>]<][-]>[-]<<<[<<<<<<<<+>
>>>>>>>-][-]>[-]<<<<<[-]>[-]>[-]>[-]<<<[-]>[-]<[-]<<<<[->>>>+<<<<]+>>>>>+<[->[-<
<<<<->>>>>]<][-]>[-]<[-]<[-]<<<[->>>+>+<<<<]>>>>[-<<<<+>>>>][-]>[-]<[-]<[->+<]+>
>+<[->[-<<->>]<][-]>[-]<[-]>[-]<[-]<[->+<]+>>+<[->[-<<->>]<][-]>[-]<<][-]<[-]<<<
[->>>+>+<<<<]>>>>[-<<<<+>>>>][-]<<<<[-]>[-]>[-]<<[-]>[-]>[-]<[-]>>[-<<+>+>]<[->+
<][-]>>[-]<<[-]<[->+<]+>>>+<<[->>[-<<<->>>]<<][-]>>[-]<<[-]<<[-]>[-<+>>+<]>[-<+>
][-]>>[-]<<[-]<<[->>+<<]+>>>>+<<[->>[-<<<<->>>>]<<][-]>>[-]<<<<[<[-]>>>>[-<<<<+>
>>>]<<<-]>[<<,>>-]<[-]>[-]<<
END

# digit '0'=48
run_ok("bfpp $test.in > $test.bf");
spew("$test.in", "\n\n\t  0.\n");
capture_ok("echo 0 | bf -D $test.bf < $test.in", <<END);
Tape: 48 
     ^^^ (ptr=0)

END

unlink_testfiles;
done_testing;
