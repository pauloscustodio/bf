#!/usr/bin/env perl

BEGIN { use lib 't'; require 'testlib.pl'; }

use Modern::Perl;

# sign16 - error no arguments
spew("$test.in", "sign16");
capture_nok("bfpp $test.in", <<END);
$test.in:1:7: error: expected '(' after macro name 'sign16'
END

# sign16 - error empty arguments
spew("$test.in", "sign16()");
capture_nok("bfpp $test.in", <<END);
$test.in:1:9: error: macro 'sign16' expects 1 argument
END

# sign16 - error too many arguments
spew("$test.in", "sign16(A,B");
capture_nok("bfpp $test.in", <<END);
$test.in:1:9: error: expected ')' at end of macro call, found ','
END

# sign16 - true if negative
spew("$test.in", "alloc_cell16(X) sign16(X)");
capture_ok("bfpp $test.in", <<END);
[ Generated by bfpp, see https://github.com/pauloscustodio/bf
  5300 instructions, 18 tape cells
]
[-]>[-]>[-]>[-]<[-]>[-]+++++++++++++++++++++++++++++++++++++++++++++++++++++++++
+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++>[-]>[-]>
[-]<<[-]<<<[->>>+>>+<<<<<]>>>>>[-<<<<<+>>>>>][-]>[-]>[-]>[-]>[-]<<<<[-]<<[->>+>>
>>+<<<<<<]>>>>>>[-<<<<<<+>>>>>>][-]<<<[-]<<<<[->>>>+>>>+<<<<<<<]>>>>>>>[-<<<<<<<
+>>>>>>>][-]<<[-]<<[->>+>>+<<<<]>>>>[-<<<<+>>>>][-]>[-]>[-]<<[-]<<[->>+<<]>>>>>[
-]>[-]<[-]<<<[->>>+<<<]+>>>>+<[->[-<<<<->>>>]<][-]>[-]<[-]>[-]<[-]<<<[->>>+<<<]+
>>>>+<[->[-<<<<->>>>]<][-]>[-]<[-]<<[-]<<<<[->>>>+>>+<<<<<<]>>>>>>[-<<<<<<+>>>>>
>][-]>[-]<[-]<<[->>+<<]+>>>+<[->[-<<<->>>]<][-]>[-]<[-]>[-]<[-]<<[->>+<<]+>>>+<[
->[-<<<->>>]<][-]>[-]<<<<[->>[-]<[->+<]<]<<[-]>>>>[-<<<<+>>>>]<<[-]>[-]>[-]<<[-]
>[-]<[-]<<[->>+>+<<<]>>>[-<<<+>>>][-]>[-]<[-]<[->+<]+>>+<[->[-<<->>]<][-]>[-]<[-
]>[-]<[-]<[->+<]+>>+<[->[-<<->>]<][-]>[-]<<[<<<<->->>>>[-]<<<[-]<<[->>+>>>+<<<<<
]>>>>>[-<<<<<+>>>>>][-]>[-]>[-]<<[-]<<<[->>>+<<<]>>>>>>[-]>[-]<[-]<<<[->>>+<<<]+
>>>>+<[->[-<<<<->>>>]<][-]>[-]<[-]>[-]<[-]<<<[->>>+<<<]+>>>>+<[->[-<<<<->>>>]<][
-]>[-]<[-]<<[-]<<<<<[->>>>>+>>+<<<<<<<]>>>>>>>[-<<<<<<<+>>>>>>>][-]>[-]<[-]<<[->
>+<<]+>>>+<[->[-<<<->>>]<][-]>[-]<[-]>[-]<[-]<<[->>+<<]+>>>+<[->[-<<<->>>]<][-]>
[-]<<<<[->>[-]<[->+<]<]<<<[-]>>>>>[-<<<<<+>>>>>]<<[-]>[-]>[-]<<[-]<[-]<<[->>+>+<
<<]>>>[-<<<+>>>][-]>[-]<[-]<[->+<]+>>+<[->[-<<->>]<][-]>[-]<[-]>[-]<[-]<[->+<]+>
>+<[->[-<<->>]<][-]>[-]<<][-]<<<<<<[-]>>>>>>[-]<[-]<<<[->>>+>+<<<<]>>>>[-<<<<+>>
>>][-]>[-]<[-]<[->+<]+>>+<[->[-<<->>]<][-]>[-]<[-]>[-]>[-]<<[-]<[->+<]>>>>[-]>[-
]<[-]<<<[->>>+<<<]+>>>>+<[->[-<<<<->>>>]<][-]>[-]<[-]>[-]<[-]<<<[->>>+<<<]+>>>>+
<[->[-<<<<->>>>]<][-]>[-]<[-]<<[-]<<<<[->>>>+>>+<<<<<<]>>>>>>[-<<<<<<+>>>>>>][-]
>[-]<[-]<<[->>+<<]+>>>+<[->[-<<<->>>]<][-]>[-]<[-]>[-]<[-]<<[->>+<<]+>>>+<[->[-<
<<->>>]<][-]>[-]<<<<[->>[-]<[->+<]<]<[-]>>>[-<<<+>>>]<<[-]>[-]>[-]<<[-]>[-]>[-]<
[-]<<[->>+>+<<<]>>>[-<<<+>>>][-]>[-]<[-]<[->+<]+>>+<[->[-<<->>]<][-]>[-]<[-]<<[-
]>[-<+>>+<]>[-<+>][-]>[-]<[-]<<[->>+<<]+>>>+<[->[-<<<->>>]<][-]>[-]<<<[<<<<<<+>>
>>>>-][-]>[-]<<<<<[-]>[-]>[-]>[-]<<<[-]<[-]<<<<[->>>>+>+<<<<<]>>>>>[-<<<<<+>>>>>
][-]>[-]<[-]<<<[->>>+>+<<<<]>>>>[-<<<<+>>>>][-]<[-<->][-]>[-]<[-]<[->+<]+>>+<[->
[-<<->>]<][-]>[-]<[-]>[-]>[-]<[-]<<[->>+>+<<<]>>>[-<<<+>>>][-]>[-]<[-]<[->+<]+>>
+<[->[-<<->>]<][-]>[-]<[-]<<[-]>[-<+>>+<]>[-<+>][-]>[-]<[-]<<[->>+<<]+>>>+<[->[-
<<<->>>]<][-]>[-]<<<[>>[-]<<<<[-]<<<<[->>>>+>>>>+<<<<<<<<]>>>>>>>>[-<<<<<<<<+>>>
>>>>>][-]>[-]>[-]>[-]>[-]<<<<[-]<<<<[->>>>+>>>>+<<<<<<<<]>>>>>>>>[-<<<<<<<<+>>>>
>>>>][-]<<<[-]<<<<<<<[->>>>>>>+>>>+<<<<<<<<<<]>>>>>>>>>>[-<<<<<<<<<<+>>>>>>>>>>]
[-]<<[-]<<[->>+>>+<<<<]>>>>[-<<<<+>>>>][-]>[-]>[-]<<[-]<<[->>+<<]>>>>>[-]>[-]<[-
]<<<[->>>+<<<]+>>>>+<[->[-<<<<->>>>]<][-]>[-]<[-]>[-]<[-]<<<[->>>+<<<]+>>>>+<[->
[-<<<<->>>>]<][-]>[-]<[-]<<[-]<<<<[->>>>+>>+<<<<<<]>>>>>>[-<<<<<<+>>>>>>][-]>[-]
<[-]<<[->>+<<]+>>>+<[->[-<<<->>>]<][-]>[-]<[-]>[-]<[-]<<[->>+<<]+>>>+<[->[-<<<->
>>]<][-]>[-]<<<<[->>[-]<[->+<]<]<<[-]>>>>[-<<<<+>>>>]<<[-]>[-]>[-]<<[-]>[-]<[-]<
<[->>+>+<<<]>>>[-<<<+>>>][-]>[-]<[-]<[->+<]+>>+<[->[-<<->>]<][-]>[-]<[-]>[-]<[-]
<[->+<]+>>+<[->[-<<->>]<][-]>[-]<<[<<<<->->>>>[-]<<<[-]<<[->>+>>>+<<<<<]>>>>>[-<
<<<<+>>>>>][-]>[-]>[-]<<[-]<<<[->>>+<<<]>>>>>>[-]>[-]<[-]<<<[->>>+<<<]+>>>>+<[->
[-<<<<->>>>]<][-]>[-]<[-]>[-]<[-]<<<[->>>+<<<]+>>>>+<[->[-<<<<->>>>]<][-]>[-]<[-
]<<[-]<<<<<[->>>>>+>>+<<<<<<<]>>>>>>>[-<<<<<<<+>>>>>>>][-]>[-]<[-]<<[->>+<<]+>>>
+<[->[-<<<->>>]<][-]>[-]<[-]>[-]<[-]<<[->>+<<]+>>>+<[->[-<<<->>>]<][-]>[-]<<<<[-
>>[-]<[->+<]<]<<<[-]>>>>>[-<<<<<+>>>>>]<<[-]>[-]>[-]<<[-]<[-]<<[->>+>+<<<]>>>[-<
<<+>>>][-]>[-]<[-]<[->+<]+>>+<[->[-<<->>]<][-]>[-]<[-]>[-]<[-]<[->+<]+>>+<[->[-<
<->>]<][-]>[-]<<][-]<<<<<<<<[-]>>>>>>>>[-]<[-]<<<[->>>+>+<<<<]>>>>[-<<<<+>>>>][-
]>[-]<[-]<[->+<]+>>+<[->[-<<->>]<][-]>[-]<[-]>[-]>[-]<<[-]<[->+<]>>>>[-]>[-]<[-]
<<<[->>>+<<<]+>>>>+<[->[-<<<<->>>>]<][-]>[-]<[-]>[-]<[-]<<<[->>>+<<<]+>>>>+<[->[
-<<<<->>>>]<][-]>[-]<[-]<<[-]<<<<[->>>>+>>+<<<<<<]>>>>>>[-<<<<<<+>>>>>>][-]>[-]<
[-]<<[->>+<<]+>>>+<[->[-<<<->>>]<][-]>[-]<[-]>[-]<[-]<<[->>+<<]+>>>+<[->[-<<<->>
>]<][-]>[-]<<<<[->>[-]<[->+<]<]<[-]>>>[-<<<+>>>]<<[-]>[-]>[-]<<[-]>[-]>[-]<[-]<<
[->>+>+<<<]>>>[-<<<+>>>][-]>[-]<[-]<[->+<]+>>+<[->[-<<->>]<][-]>[-]<[-]<<[-]>[-<
+>>+<]>[-<+>][-]>[-]<[-]<<[->>+<<]+>>>+<[->[-<<<->>>]<][-]>[-]<<<[<<<<<<<<+>>>>>
>>>-][-]>[-]<<<<<[-]>[-]>[-]>[-]<<<<<-][-]>[-]<[-]>[-]>[-]<[-]<<<[->>>+>+<<<<]>>
>>[-<<<<+>>>>][-]>[-]<[-]<[->+<]+>>+<[->[-<<->>]<][-]>[-]<[-]<<[-]>[-<+>>+<]>[-<
+>][-]>[-]<[-]<<[->>+<<]+>>>+<[->[-<<<->>>]<][-]>[-]<<<[<<<<<<[-]+>[-]>>>>>-]>[<
<<<<<<[-]>[-]>>>>>>-]<[-]>[-]<<<[-]>[-]<[-]>[-]>[-]<<[-]<<<<[->>>>+>>+<<<<<<]>>>
>>>[-<<<<<<+>>>>>>][-]>[-]<[-]<<[->>+<<]+>>>+<[->[-<<<->>>]<][-]>[-]<[-]<[-]<<<<
[->>>>+>+<<<<<]>>>>>[-<<<<<+>>>>>][-]>[-]<[-]<[->+<]+>>+<[->[-<<->>]<][-]>[-]<[-
]>[-]>[-]<<[-]<<[->>+<<]>>>>>[-]>[-]<[-]<<<[->>>+<<<]+>>>>+<[->[-<<<<->>>>]<][-]
>[-]<[-]>[-]<[-]<<<[->>>+<<<]+>>>>+<[->[-<<<<->>>>]<][-]>[-]<[-]<<[-]<<[->>+>>+<
<<<]>>>>[-<<<<+>>>>][-]>[-]<[-]<<[->>+<<]+>>>+<[->[-<<<->>>]<][-]>[-]<[-]>[-]<[-
]<<[->>+<<]+>>>+<[->[-<<<->>>]<][-]>[-]<<<<[->>[-]<[->+<]<]<<[-]>>>>[-<<<<+>>>>]
<<[-]>[-]>[-]<<[-]>[-]>[-]<[-]<<<[->>>+>+<<<<]>>>>[-<<<<+>>>>][-]>[-]<[-]<[->+<]
+>>+<[->[-<<->>]<][-]>[-]<[-]<<[-]>[-<+>>+<]>[-<+>][-]>[-]<[-]<<[->>+<<]+>>>+<[-
>[-<<<->>>]<][-]>[-]<<<[<<<<<<[-]+>[-]>>>>>-]>[<<<<<<<[-]>[-]>>>>>>-]<[-]>[-]<<<
[-]>[-]<<<[-]>[-]<<<
END

# sign16 - execute a test program
for my $i (0, 1, 2, 32766, 32767) {
	spew("$test.in", "alloc_cell16(X) set16(X, $i) sign16(X)");
	capture_ok("bfpp $test.in | bf -D", <<END);
Tape:  0 
     ^^^ (ptr=0)

END
}

for my $i (32768, 32769, 65534, 65535) {
	spew("$test.in", "alloc_cell16(X) set16(X, $i) sign16(X)");
	capture_ok("bfpp $test.in | bf -D", <<END);
Tape:  1 
     ^^^ (ptr=0)

END
}

unlink_testfiles;
done_testing;
