#!/usr/bin/env perl

BEGIN { use lib 't'; require 'testlib.pl'; }

use Modern::Perl;

# sign - error no arguments
spew("$test.in", "sign");
capture_nok("bfpp $test.in", <<END);
$test.in:1:5: error: expected '(' after macro name 'sign'
END

# sign - error empty arguments
spew("$test.in", "sign()");
capture_nok("bfpp $test.in", <<END);
$test.in:1:7: error: macro 'sign' expects 1 argument
END

# sign - error too many arguments
spew("$test.in", "sign(A,B");
capture_nok("bfpp $test.in", <<END);
$test.in:1:7: error: expected ')' at end of macro call, found ','
END

# sign - true if negative
spew("$test.in", "alloc_cell(X) sign(X)");
capture_ok("bfpp $test.in", <<END);
[
  -
]
>
[
  -
]
[
  -
]
++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
++++++++++++++++++++++++++++++++++++++++++++++++>
[
  -
]
>
[
  -
]
>
[
  -
]
>
[
  -
]
>
[
  -
]
<<<<
[
  -
]
<<
[
  ->>+>>>>+<<<<<<
]
>>>>>>
[
  -<<<<<<+>>>>>>
]
[
  -
]
[
  -
]
<<<
[
  -
]
<<
[
  ->>+>>>+<<<<<
]
>>>>>
[
  -<<<<<+>>>>>
]
[
  -
]
[
  -
]
<<
[
  -
]
<<
[
  ->>+>>+<<<<
]
>>>>
[
  -<<<<+>>>>
]
[
  -
]
[
  -
]
>
[
  -
]
>
[
  -
]
<<
[
  -
]
<<
[
  ->>+<<
]
>>>>>
[
  -
]
>
[
  -
]
<
[
  -
]
<<<
[
  ->>>+<<<
]
+>>>>+<
[
  ->
  [
    -<<<<->>>>
  ]
  <
]
[
  -
]
>
[
  -
]
<
[
  -
]
>
[
  -
]
<
[
  -
]
<<<
[
  ->>>+<<<
]
+>>>>+<
[
  ->
  [
    -<<<<->>>>
  ]
  <
]
[
  -
]
>
[
  -
]
<
[
  -
]
<<
[
  -
]
<<<<
[
  ->>>>+>>+<<<<<<
]
>>>>>>
[
  -<<<<<<+>>>>>>
]
[
  -
]
[
  -
]
>
[
  -
]
<
[
  -
]
<<
[
  ->>+<<
]
+>>>+<
[
  ->
  [
    -<<<->>>
  ]
  <
]
[
  -
]
>
[
  -
]
<
[
  -
]
>
[
  -
]
<
[
  -
]
<<
[
  ->>+<<
]
+>>>+<
[
  ->
  [
    -<<<->>>
  ]
  <
]
[
  -
]
>
[
  -
]
<<<<
[
  ->>
  [
    -
  ]
  <
  [
    ->+<
  ]
  <
]
<<
[
  -
]
>>>>
[
  -<<<<+>>>>
]
<<
[
  -
]
>
[
  -
]
>
[
  -
]
<<
[
  -
]
>
[
  -
]
<
[
  -
]
<<
[
  ->>+>+<<<
]
>>>
[
  -<<<+>>>
]
[
  -
]
[
  -
]
>
[
  -
]
<
[
  -
]
<
[
  ->+<
]
+>>+<
[
  ->
  [
    -<<->>
  ]
  <
]
[
  -
]
>
[
  -
]
<
[
  -
]
>
[
  -
]
<
[
  -
]
<
[
  ->+<
]
+>>+<
[
  ->
  [
    -<<->>
  ]
  <
]
[
  -
]
>
[
  -
]
<<
[
  <<<<->->>>>
  [
    -
  ]
  <<<
  [
    -
  ]
  <<
  [
    ->>+>>>+<<<<<
  ]
  >>>>>
  [
    -<<<<<+>>>>>
  ]
  [
    -
  ]
  [
    -
  ]
  >
  [
    -
  ]
  >
  [
    -
  ]
  <<
  [
    -
  ]
  <<<
  [
    ->>>+<<<
  ]
  >>>>>>
  [
    -
  ]
  >
  [
    -
  ]
  <
  [
    -
  ]
  <<<
  [
    ->>>+<<<
  ]
  +>>>>+<
  [
    ->
    [
      -<<<<->>>>
    ]
    <
  ]
  [
    -
  ]
  >
  [
    -
  ]
  <
  [
    -
  ]
  >
  [
    -
  ]
  <
  [
    -
  ]
  <<<
  [
    ->>>+<<<
  ]
  +>>>>+<
  [
    ->
    [
      -<<<<->>>>
    ]
    <
  ]
  [
    -
  ]
  >
  [
    -
  ]
  <
  [
    -
  ]
  <<
  [
    -
  ]
  <<<<<
  [
    ->>>>>+>>+<<<<<<<
  ]
  >>>>>>>
  [
    -<<<<<<<+>>>>>>>
  ]
  [
    -
  ]
  [
    -
  ]
  >
  [
    -
  ]
  <
  [
    -
  ]
  <<
  [
    ->>+<<
  ]
  +>>>+<
  [
    ->
    [
      -<<<->>>
    ]
    <
  ]
  [
    -
  ]
  >
  [
    -
  ]
  <
  [
    -
  ]
  >
  [
    -
  ]
  <
  [
    -
  ]
  <<
  [
    ->>+<<
  ]
  +>>>+<
  [
    ->
    [
      -<<<->>>
    ]
    <
  ]
  [
    -
  ]
  >
  [
    -
  ]
  <<<<
  [
    ->>
    [
      -
    ]
    <
    [
      ->+<
    ]
    <
  ]
  <<<
  [
    -
  ]
  >>>>>
  [
    -<<<<<+>>>>>
  ]
  <<
  [
    -
  ]
  >
  [
    -
  ]
  >
  [
    -
  ]
  <<
  [
    -
  ]
  <
  [
    -
  ]
  <<
  [
    ->>+>+<<<
  ]
  >>>
  [
    -<<<+>>>
  ]
  [
    -
  ]
  [
    -
  ]
  >
  [
    -
  ]
  <
  [
    -
  ]
  <
  [
    ->+<
  ]
  +>>+<
  [
    ->
    [
      -<<->>
    ]
    <
  ]
  [
    -
  ]
  >
  [
    -
  ]
  <
  [
    -
  ]
  >
  [
    -
  ]
  <
  [
    -
  ]
  <
  [
    ->+<
  ]
  +>>+<
  [
    ->
    [
      -<<->>
    ]
    <
  ]
  [
    -
  ]
  >
  [
    -
  ]
  <<
]
[
  -
]
<<<<<<
[
  -
]
>>>>>>
[
  -
]
<
[
  -
]
<<<
[
  ->>>+>+<<<<
]
>>>>
[
  -<<<<+>>>>
]
[
  -
]
[
  -
]
>
[
  -
]
<
[
  -
]
<
[
  ->+<
]
+>>+<
[
  ->
  [
    -<<->>
  ]
  <
]
[
  -
]
>
[
  -
]
<
[
  -
]
>
[
  -
]
>
[
  -
]
<<
[
  -
]
<
[
  ->+<
]
>>>>
[
  -
]
>
[
  -
]
<
[
  -
]
<<<
[
  ->>>+<<<
]
+>>>>+<
[
  ->
  [
    -<<<<->>>>
  ]
  <
]
[
  -
]
>
[
  -
]
<
[
  -
]
>
[
  -
]
<
[
  -
]
<<<
[
  ->>>+<<<
]
+>>>>+<
[
  ->
  [
    -<<<<->>>>
  ]
  <
]
[
  -
]
>
[
  -
]
<
[
  -
]
<<
[
  -
]
<<<<
[
  ->>>>+>>+<<<<<<
]
>>>>>>
[
  -<<<<<<+>>>>>>
]
[
  -
]
[
  -
]
>
[
  -
]
<
[
  -
]
<<
[
  ->>+<<
]
+>>>+<
[
  ->
  [
    -<<<->>>
  ]
  <
]
[
  -
]
>
[
  -
]
<
[
  -
]
>
[
  -
]
<
[
  -
]
<<
[
  ->>+<<
]
+>>>+<
[
  ->
  [
    -<<<->>>
  ]
  <
]
[
  -
]
>
[
  -
]
<<<<
[
  ->>
  [
    -
  ]
  <
  [
    ->+<
  ]
  <
]
<
[
  -
]
>>>
[
  -<<<+>>>
]
<<
[
  -
]
>
[
  -
]
>
[
  -
]
<<
[
  -
]
>
[
  -
]
>
[
  -
]
<
[
  -
]
<<
[
  ->>+>+<<<
]
>>>
[
  -<<<+>>>
]
[
  -
]
[
  -
]
>
[
  -
]
<
[
  -
]
<
[
  ->+<
]
+>>+<
[
  ->
  [
    -<<->>
  ]
  <
]
[
  -
]
>
[
  -
]
<
[
  -
]
<<
[
  -
]
>
[
  -<+>>+<
]
>
[
  -<+>
]
[
  -
]
[
  -
]
>
[
  -
]
<
[
  -
]
<<
[
  ->>+<<
]
+>>>+<
[
  ->
  [
    -<<<->>>
  ]
  <
]
[
  -
]
>
[
  -
]
<<<
[
  <<<<<<+>>>>>>-
]
[
  -
]
>
[
  -
]
<<<<<
[
  -
]
>
[
  -
]
>
[
  -
]
>
[
  -
]
<<<
[
  -
]
>
[
  -
]
<
[
  -
]
<<
[
  ->>+<<
]
+>>>+<
[
  ->
  [
    -<<<->>>
  ]
  <
]
[
  -
]
>
[
  -
]
<<
[
  -
]
<
END

# sign - execute a test program
for my $i (0, 1, 2, 126, 127) {
	spew("$test.in", "alloc_cell(X) set(X, $i) sign(X)");
	capture_ok("bfpp $test.in | bf -D", <<END);
Tape:  0 
     ^^^ (ptr=0)

END
}

for my $i (128, 129, 254, 255) {
	spew("$test.in", "alloc_cell(X) set(X, $i) sign(X)");
	capture_ok("bfpp $test.in | bf -D", <<END);
Tape:  1 
     ^^^ (ptr=0)

END
}

unlink_testfiles;
done_testing;
