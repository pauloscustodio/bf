#!/usr/bin/env perl

BEGIN { use lib 't'; require 'testlib.pl'; }

use Modern::Perl;

# shr16 - error no arguments
spew("$test.in", "shr16");
capture_nok("bfpp $test.in", <<END);
$test.in:1:6: error: expected '(' after macro name 'shr16'
END

# shr16 - error empty arguments
spew("$test.in", "shr16()");
capture_nok("bfpp $test.in", <<END);
$test.in:1:8: error: macro 'shr16' expects 2 arguments
END

# shr16 - error too many arguments
spew("$test.in", "shr16(A,B,C)");
capture_nok("bfpp $test.in", <<END);
$test.in:1:10: error: expected ')' at end of macro call, found ','
END

# shr16(a,b)
spew("$test.in", <<END);
alloc_cell16(A)
alloc_cell16(B)
shr16(A,B)
END
capture_ok("bfpp $test.in", <<END);
[ Generated by bfpp, see https://github.com/pauloscustodio/bf
  16443 instructions, 29 tape cells
]
[-]>[-]>[-]>[-]>[-]>[-]>[-]>[-]>[-]>[-]<+>>[-]>[-]<++>>[-]>[-]>[-]<<[-]<<<<<<<<<
<[->>>>>>>>>>+>>+<<<<<<<<<<<<]>>>>>>>>>>>>[-<<<<<<<<<<<<+>>>>>>>>>>>>][-]<[-]<<<
<<<<<<<[->>>>>>>>>>+>+<<<<<<<<<<<]>>>>>>>>>>>[-<<<<<<<<<<<+>>>>>>>>>>>][-]<<[>>[
-]<<<<<<<<[-]<<<<<<[->>>>>>+>>>>>>>>+<<<<<<<<<<<<<<]>>>>>>>>>>>>>>[-<<<<<<<<<<<<
<<+>>>>>>>>>>>>>>][-]<<<<<<<[-]<<<<<<[->>>>>>+>>>>>>>+<<<<<<<<<<<<<]>>>>>>>>>>>>
>[-<<<<<<<<<<<<<+>>>>>>>>>>>>>][-]>[-]>[-]<<[-]<<<<<<<[->>>>>>>+>>+<<<<<<<<<]>>>
>>>>>>[-<<<<<<<<<+>>>>>>>>>][-]>[-]>[-]>[-]>[-]<<<<[-]<<[->>+>>>>+<<<<<<]>>>>>>[
-<<<<<<+>>>>>>][-]<<<[-]<<<<<<[->>>>>>+>>>+<<<<<<<<<]>>>>>>>>>[-<<<<<<<<<+>>>>>>
>>>][-]<<[-]<<[->>+>>+<<<<]>>>>[-<<<<+>>>>][-]>[-]>[-]<<[-]<<[->>+<<]>>>>>[-]>[-
]<[-]<<<[->>>+<<<]+>>>>+<[->[-<<<<->>>>]<][-]>[-]<[-]>[-]<[-]<<<[->>>+<<<]+>>>>+
<[->[-<<<<->>>>]<][-]>[-]<[-]<<[-]<<<<[->>>>+>>+<<<<<<]>>>>>>[-<<<<<<+>>>>>>][-]
>[-]<[-]<<[->>+<<]+>>>+<[->[-<<<->>>]<][-]>[-]<[-]>[-]<[-]<<[->>+<<]+>>>+<[->[-<
<<->>>]<][-]>[-]<<<<[->>[-]<[->+<]<]<<[-]>>>>[-<<<<+>>>>]<<[-]>[-]>[-]<<[-]>[-]<
[-]<<[->>+>+<<<]>>>[-<<<+>>>][-]>[-]<[-]<[->+<]+>>+<[->[-<<->>]<][-]>[-]<[-]>[-]
<[-]<[->+<]+>>+<[->[-<<->>]<][-]>[-]<<[<<<<->->>>>[-]<<<[-]<<[->>+>>>+<<<<<]>>>>
>[-<<<<<+>>>>>][-]>[-]>[-]<<[-]<<<[->>>+<<<]>>>>>>[-]>[-]<[-]<<<[->>>+<<<]+>>>>+
<[->[-<<<<->>>>]<][-]>[-]<[-]>[-]<[-]<<<[->>>+<<<]+>>>>+<[->[-<<<<->>>>]<][-]>[-
]<[-]<<[-]<<<<<[->>>>>+>>+<<<<<<<]>>>>>>>[-<<<<<<<+>>>>>>>][-]>[-]<[-]<<[->>+<<]
+>>>+<[->[-<<<->>>]<][-]>[-]<[-]>[-]<[-]<<[->>+<<]+>>>+<[->[-<<<->>>]<][-]>[-]<<
<<[->>[-]<[->+<]<]<<<[-]>>>>>[-<<<<<+>>>>>]<<[-]>[-]>[-]<<[-]<[-]<<[->>+>+<<<]>>
>[-<<<+>>>][-]>[-]<[-]<[->+<]+>>+<[->[-<<->>]<][-]>[-]<[-]>[-]<[-]<[->+<]+>>+<[-
>[-<<->>]<][-]>[-]<<][-]<<<<<<[-]>>>>>>[-]<[-]<<<[->>>+>+<<<<]>>>>[-<<<<+>>>>][-
]>[-]<[-]<[->+<]+>>+<[->[-<<->>]<][-]>[-]<[-]>[-]>[-]<<[-]<[->+<]>>>>[-]>[-]<[-]
<<<[->>>+<<<]+>>>>+<[->[-<<<<->>>>]<][-]>[-]<[-]>[-]<[-]<<<[->>>+<<<]+>>>>+<[->[
-<<<<->>>>]<][-]>[-]<[-]<<[-]<<<<[->>>>+>>+<<<<<<]>>>>>>[-<<<<<<+>>>>>>][-]>[-]<
[-]<<[->>+<<]+>>>+<[->[-<<<->>>]<][-]>[-]<[-]>[-]<[-]<<[->>+<<]+>>>+<[->[-<<<->>
>]<][-]>[-]<<<<[->>[-]<[->+<]<]<[-]>>>[-<<<+>>>]<<[-]>[-]>[-]<<[-]>[-]>[-]<[-]<<
[->>+>+<<<]>>>[-<<<+>>>][-]>[-]<[-]<[->+<]+>>+<[->[-<<->>]<][-]>[-]<[-]<<[-]>[-<
+>>+<]>[-<+>][-]>[-]<[-]<<[->>+<<]+>>>+<[->[-<<<->>>]<][-]>[-]<<<[<<<<<<+>>>>>>-
][-]>[-]<<<<<[-]>[-]>[-]>[-]<<<[-]<[-]<<<<<<<<[->>>>>>>>+>+<<<<<<<<<]>>>>>>>>>[-
<<<<<<<<<+>>>>>>>>>][-]>[-]<[-]<<<<<[->>>>>+>+<<<<<<]>>>>>>[-<<<<<<+>>>>>>][-]<[
-<->][-]>[-]<[-]<[->+<]+>>+<[->[-<<->>]<][-]>[-]<[-]>[-]>[-]<[-]<<[->>+>+<<<]>>>
[-<<<+>>>][-]>[-]<[-]<[->+<]+>>+<[->[-<<->>]<][-]>[-]<[-]<<[-]>[-<+>>+<]>[-<+>][
-]>[-]<[-]<<[->>+<<]+>>>+<[->[-<<<->>>]<][-]>[-]<<<[>>[-]<<<<[-]<<<<<<<<[->>>>>>
>>+>>>>+<<<<<<<<<<<<]>>>>>>>>>>>>[-<<<<<<<<<<<<+>>>>>>>>>>>>][-]>[-]>[-]>[-]>[-]
<<<<[-]<<<<[->>>>+>>>>+<<<<<<<<]>>>>>>>>[-<<<<<<<<+>>>>>>>>][-]<<<[-]<<<<<<<<<[-
>>>>>>>>>+>>>+<<<<<<<<<<<<]>>>>>>>>>>>>[-<<<<<<<<<<<<+>>>>>>>>>>>>][-]<<[-]<<[->
>+>>+<<<<]>>>>[-<<<<+>>>>][-]>[-]>[-]<<[-]<<[->>+<<]>>>>>[-]>[-]<[-]<<<[->>>+<<<
]+>>>>+<[->[-<<<<->>>>]<][-]>[-]<[-]>[-]<[-]<<<[->>>+<<<]+>>>>+<[->[-<<<<->>>>]<
][-]>[-]<[-]<<[-]<<<<[->>>>+>>+<<<<<<]>>>>>>[-<<<<<<+>>>>>>][-]>[-]<[-]<<[->>+<<
]+>>>+<[->[-<<<->>>]<][-]>[-]<[-]>[-]<[-]<<[->>+<<]+>>>+<[->[-<<<->>>]<][-]>[-]<
<<<[->>[-]<[->+<]<]<<[-]>>>>[-<<<<+>>>>]<<[-]>[-]>[-]<<[-]>[-]<[-]<<[->>+>+<<<]>
>>[-<<<+>>>][-]>[-]<[-]<[->+<]+>>+<[->[-<<->>]<][-]>[-]<[-]>[-]<[-]<[->+<]+>>+<[
->[-<<->>]<][-]>[-]<<[<<<<->->>>>[-]<<<[-]<<[->>+>>>+<<<<<]>>>>>[-<<<<<+>>>>>][-
]>[-]>[-]<<[-]<<<[->>>+<<<]>>>>>>[-]>[-]<[-]<<<[->>>+<<<]+>>>>+<[->[-<<<<->>>>]<
][-]>[-]<[-]>[-]<[-]<<<[->>>+<<<]+>>>>+<[->[-<<<<->>>>]<][-]>[-]<[-]<<[-]<<<<<[-
>>>>>+>>+<<<<<<<]>>>>>>>[-<<<<<<<+>>>>>>>][-]>[-]<[-]<<[->>+<<]+>>>+<[->[-<<<->>
>]<][-]>[-]<[-]>[-]<[-]<<[->>+<<]+>>>+<[->[-<<<->>>]<][-]>[-]<<<<[->>[-]<[->+<]<
]<<<[-]>>>>>[-<<<<<+>>>>>]<<[-]>[-]>[-]<<[-]<[-]<<[->>+>+<<<]>>>[-<<<+>>>][-]>[-
]<[-]<[->+<]+>>+<[->[-<<->>]<][-]>[-]<[-]>[-]<[-]<[->+<]+>>+<[->[-<<->>]<][-]>[-
]<<][-]<<<<<<<<[-]>>>>>>>>[-]<[-]<<<[->>>+>+<<<<]>>>>[-<<<<+>>>>][-]>[-]<[-]<[->
+<]+>>+<[->[-<<->>]<][-]>[-]<[-]>[-]>[-]<<[-]<[->+<]>>>>[-]>[-]<[-]<<<[->>>+<<<]
+>>>>+<[->[-<<<<->>>>]<][-]>[-]<[-]>[-]<[-]<<<[->>>+<<<]+>>>>+<[->[-<<<<->>>>]<]
[-]>[-]<[-]<<[-]<<<<[->>>>+>>+<<<<<<]>>>>>>[-<<<<<<+>>>>>>][-]>[-]<[-]<<[->>+<<]
+>>>+<[->[-<<<->>>]<][-]>[-]<[-]>[-]<[-]<<[->>+<<]+>>>+<[->[-<<<->>>]<][-]>[-]<<
<<[->>[-]<[->+<]<]<[-]>>>[-<<<+>>>]<<[-]>[-]>[-]<<[-]>[-]>[-]<[-]<<[->>+>+<<<]>>
>[-<<<+>>>][-]>[-]<[-]<[->+<]+>>+<[->[-<<->>]<][-]>[-]<[-]<<[-]>[-<+>>+<]>[-<+>]
[-]>[-]<[-]<<[->>+<<]+>>>+<[->[-<<<->>>]<][-]>[-]<<<[<<<<<<<<+>>>>>>>>-][-]>[-]<
<<<<[-]>[-]>[-]>[-]<<<<<-][-]>[-]<[-]>[-]>[-]<[-]<<<[->>>+>+<<<<]>>>>[-<<<<+>>>>
][-]>[-]<[-]<[->+<]+>>+<[->[-<<->>]<][-]>[-]<[-]<<[-]>[-<+>>+<]>[-<+>][-]>[-]<[-
]<<[->>+<<]+>>>+<[->[-<<<->>>]<][-]>[-]<<<[<<<<<<<<<<[-]+>[-]>>>>>>>>>-]>[<<<<<<
<<<<<[-]>[-]>>>>>>>>>>-]<[-]>[-]<<<[-]>[-]<[-]>[-]>[-]<<[-]<<<<<<<<[->>>>>>>>+>>
+<<<<<<<<<<]>>>>>>>>>>[-<<<<<<<<<<+>>>>>>>>>>][-]>[-]<[-]<<[->>+<<]+>>>+<[->[-<<
<->>>]<][-]>[-]<[-]<[-]<<<<<<<<[->>>>>>>>+>+<<<<<<<<<]>>>>>>>>>[-<<<<<<<<<+>>>>>
>>>>][-]>[-]<[-]<[->+<]+>>+<[->[-<<->>]<][-]>[-]<[-]>[-]>[-]<<[-]<<[->>+<<]>>>>>
[-]>[-]<[-]<<<[->>>+<<<]+>>>>+<[->[-<<<<->>>>]<][-]>[-]<[-]>[-]<[-]<<<[->>>+<<<]
+>>>>+<[->[-<<<<->>>>]<][-]>[-]<[-]<<[-]<<[->>+>>+<<<<]>>>>[-<<<<+>>>>][-]>[-]<[
-]<<[->>+<<]+>>>+<[->[-<<<->>>]<][-]>[-]<[-]>[-]<[-]<<[->>+<<]+>>>+<[->[-<<<->>>
]<][-]>[-]<<<<[->>[-]<[->+<]<]<<[-]>>>>[-<<<<+>>>>]<<[-]>[-]>[-]<<[-]>[-]>[-]<[-
]<<<[->>>+>+<<<<]>>>>[-<<<<+>>>>][-]>[-]<[-]<[->+<]+>>+<[->[-<<->>]<][-]>[-]<[-]
<<[-]>[-<+>>+<]>[-<+>][-]>[-]<[-]<<[->>+<<]+>>>+<[->[-<<<->>>]<][-]>[-]<<<[<<<<<
<<<<<[-]+>[-]>>>>>>>>>-]>[<<<<<<<<<<<[-]>[-]>>>>>>>>>>-]<[-]>[-]<<<[-]>[-]<[-]>[
-]<[-]<<<<<<<<[->>>>>>>>+>+<<<<<<<<<]>>>>>>>>>[-<<<<<<<<<+>>>>>>>>>][-]>[-]<[-]<
[->+<]+>>+<[->[-<<->>]<][-]>[-]<[-]>[-]<[-]<[->+<]+>>+<[->[-<<->>]<][-]>[-]<<[>[
-]>[-]>[-]<<[-]<<<<<<<<<<<<<<<[->>>>>>>>>>>>>>>+>>+<<<<<<<<<<<<<<<<<]>>>>>>>>>>>
>>>>>>[-<<<<<<<<<<<<<<<<<+>>>>>>>>>>>>>>>>>][-]>[-]<[-]<<<<<<<[->>>>>>>+>+<<<<<<
<<]>>>>>>>>[-<<<<<<<<+>>>>>>>>][-]<[-<<<<<<<<<<<<<<<<<->>>>>>>>>>>>>>>>>][-]<[-]
<<<<<<<<<<<<<<<<[->>>>>>>>>>>>>>>>+>+<<<<<<<<<<<<<<<<<]>>>>>>>>>>>>>>>>>[-<<<<<<
<<<<<<<<<<<+>>>>>>>>>>>>>>>>>][-]>[-]>[-]>[-]>[-]<<<<[-]<[->+>>>>+<<<<<]>>>>>[-<
<<<<+>>>>>][-]<<<[-]<<<[->>>+>>>+<<<<<<]>>>>>>[-<<<<<<+>>>>>>][-]<<[-]<<[->>+>>+
<<<<]>>>>[-<<<<+>>>>][-]>[-]>[-]<<[-]<<[->>+<<]>>>>>[-]>[-]<[-]<<<[->>>+<<<]+>>>
>+<[->[-<<<<->>>>]<][-]>[-]<[-]>[-]<[-]<<<[->>>+<<<]+>>>>+<[->[-<<<<->>>>]<][-]>
[-]<[-]<<[-]<<<<[->>>>+>>+<<<<<<]>>>>>>[-<<<<<<+>>>>>>][-]>[-]<[-]<<[->>+<<]+>>>
+<[->[-<<<->>>]<][-]>[-]<[-]>[-]<[-]<<[->>+<<]+>>>+<[->[-<<<->>>]<][-]>[-]<<<<[-
>>[-]<[->+<]<]<<[-]>>>>[-<<<<+>>>>]<<[-]>[-]>[-]<<[-]>[-]<[-]<<[->>+>+<<<]>>>[-<
<<+>>>][-]>[-]<[-]<[->+<]+>>+<[->[-<<->>]<][-]>[-]<[-]>[-]<[-]<[->+<]+>>+<[->[-<
<->>]<][-]>[-]<<[<<<<->->>>>[-]<<<[-]<<[->>+>>>+<<<<<]>>>>>[-<<<<<+>>>>>][-]>[-]
>[-]<<[-]<<<[->>>+<<<]>>>>>>[-]>[-]<[-]<<<[->>>+<<<]+>>>>+<[->[-<<<<->>>>]<][-]>
[-]<[-]>[-]<[-]<<<[->>>+<<<]+>>>>+<[->[-<<<<->>>>]<][-]>[-]<[-]<<[-]<<<<<[->>>>>
+>>+<<<<<<<]>>>>>>>[-<<<<<<<+>>>>>>>][-]>[-]<[-]<<[->>+<<]+>>>+<[->[-<<<->>>]<][
-]>[-]<[-]>[-]<[-]<<[->>+<<]+>>>+<[->[-<<<->>>]<][-]>[-]<<<<[->>[-]<[->+<]<]<<<[
-]>>>>>[-<<<<<+>>>>>]<<[-]>[-]>[-]<<[-]<[-]<<[->>+>+<<<]>>>[-<<<+>>>][-]>[-]<[-]
<[->+<]+>>+<[->[-<<->>]<][-]>[-]<[-]>[-]<[-]<[->+<]+>>+<[->[-<<->>]<][-]>[-]<<][
-]<<<<<[-]>>>>>[-]<[-]<<[->>+>+<<<]>>>[-<<<+>>>][-]>[-]<[-]<[->+<]+>>+<[->[-<<->
>]<][-]>[-]<[-]>[-]>[-]<<[-]<[->+<]>>>>[-]>[-]<[-]<<<[->>>+<<<]+>>>>+<[->[-<<<<-
>>>>]<][-]>[-]<[-]>[-]<[-]<<<[->>>+<<<]+>>>>+<[->[-<<<<->>>>]<][-]>[-]<[-]<<[-]<
<<<<[->>>>>+>>+<<<<<<<]>>>>>>>[-<<<<<<<+>>>>>>>][-]>[-]<[-]<<[->>+<<]+>>>+<[->[-
<<<->>>]<][-]>[-]<[-]>[-]<[-]<<[->>+<<]+>>>+<[->[-<<<->>>]<][-]>[-]<<<<[->>[-]<[
->+<]<]<[-]>>>[-<<<+>>>]<<[-]>[-]>[-]<<[-]>[-]>[-]<[-]<<[->>+>+<<<]>>>[-<<<+>>>]
[-]>[-]<[-]<[->+<]+>>+<[->[-<<->>]<][-]>[-]<[-]<<[-]>[-<+>>+<]>[-<+>][-]>[-]<[-]
<<[->>+<<]+>>>+<[->[-<<<->>>]<][-]>[-]<<<[<<<<<+>>>>>-][-]>[-]<<<<<[-]>[-]>[-]>[
-]<<<[-]>[-]<[-]<<<<<<[->>>>>>+>+<<<<<<<]>>>>>>>[-<<<<<<<+>>>>>>>][-]<[-<<<<<<<<
<<<<<<<<->>>>>>>>>>>>>>>>][-]>[-]<[-]<[->+>+<<]>>[-<<+>>][-]<[-<<<<<<<<<<<<<<<<-
>>>>>>>>>>>>>>>>][-]<<[-]>[-]<[-]>[-]>[-]<<[-]<<<<<<<<<<<[->>>>>>>>>>>+>>+<<<<<<
<<<<<<<]>>>>>>>>>>>>>[-<<<<<<<<<<<<<+>>>>>>>>>>>>>][-]>[-]<[-]<<<<<<<<<[->>>>>>>
>>+>+<<<<<<<<<<]>>>>>>>>>>[-<<<<<<<<<<+>>>>>>>>>>][-]<[-<<<<<<<<<<<<<+>>>>>>>>>>
>>>][-]<[-]<<<<<<<<<<<<[->>>>>>>>>>>>+>+<<<<<<<<<<<<<]>>>>>>>>>>>>>[-<<<<<<<<<<<
<<+>>>>>>>>>>>>>][-]>[-]>[-]>[-]>[-]<<<<[-]<[->+>>>>+<<<<<]>>>>>[-<<<<<+>>>>>][-
]<<<[-]<<<[->>>+>>>+<<<<<<]>>>>>>[-<<<<<<+>>>>>>][-]<<[-]<<[->>+>>+<<<<]>>>>[-<<
<<+>>>>][-]>[-]>[-]<<[-]<<[->>+<<]>>>>>[-]>[-]<[-]<<<[->>>+<<<]+>>>>+<[->[-<<<<-
>>>>]<][-]>[-]<[-]>[-]<[-]<<<[->>>+<<<]+>>>>+<[->[-<<<<->>>>]<][-]>[-]<[-]<<[-]<
<<<[->>>>+>>+<<<<<<]>>>>>>[-<<<<<<+>>>>>>][-]>[-]<[-]<<[->>+<<]+>>>+<[->[-<<<->>
>]<][-]>[-]<[-]>[-]<[-]<<[->>+<<]+>>>+<[->[-<<<->>>]<][-]>[-]<<<<[->>[-]<[->+<]<
]<<[-]>>>>[-<<<<+>>>>]<<[-]>[-]>[-]<<[-]>[-]<[-]<<[->>+>+<<<]>>>[-<<<+>>>][-]>[-
]<[-]<[->+<]+>>+<[->[-<<->>]<][-]>[-]<[-]>[-]<[-]<[->+<]+>>+<[->[-<<->>]<][-]>[-
]<<[<<<<->->>>>[-]<<<[-]<<[->>+>>>+<<<<<]>>>>>[-<<<<<+>>>>>][-]>[-]>[-]<<[-]<<<[
->>>+<<<]>>>>>>[-]>[-]<[-]<<<[->>>+<<<]+>>>>+<[->[-<<<<->>>>]<][-]>[-]<[-]>[-]<[
-]<<<[->>>+<<<]+>>>>+<[->[-<<<<->>>>]<][-]>[-]<[-]<<[-]<<<<<[->>>>>+>>+<<<<<<<]>
>>>>>>[-<<<<<<<+>>>>>>>][-]>[-]<[-]<<[->>+<<]+>>>+<[->[-<<<->>>]<][-]>[-]<[-]>[-
]<[-]<<[->>+<<]+>>>+<[->[-<<<->>>]<][-]>[-]<<<<[->>[-]<[->+<]<]<<<[-]>>>>>[-<<<<
<+>>>>>]<<[-]>[-]>[-]<<[-]<[-]<<[->>+>+<<<]>>>[-<<<+>>>][-]>[-]<[-]<[->+<]+>>+<[
->[-<<->>]<][-]>[-]<[-]>[-]<[-]<[->+<]+>>+<[->[-<<->>]<][-]>[-]<<][-]<<<<<[-]>>>
>>[-]<[-]<<<[->>>+>+<<<<]>>>>[-<<<<+>>>>][-]>[-]<[-]<[->+<]+>>+<[->[-<<->>]<][-]
>[-]<[-]>[-]>[-]<<[-]<[->+<]>>>>[-]>[-]<[-]<<<[->>>+<<<]+>>>>+<[->[-<<<<->>>>]<]
[-]>[-]<[-]>[-]<[-]<<<[->>>+<<<]+>>>>+<[->[-<<<<->>>>]<][-]>[-]<[-]<<[-]<<<<[->>
>>+>>+<<<<<<]>>>>>>[-<<<<<<+>>>>>>][-]>[-]<[-]<<[->>+<<]+>>>+<[->[-<<<->>>]<][-]
>[-]<[-]>[-]<[-]<<[->>+<<]+>>>+<[->[-<<<->>>]<][-]>[-]<<<<[->>[-]<[->+<]<]<[-]>>
>[-<<<+>>>]<<[-]>[-]>[-]<<[-]>[-]>[-]<[-]<<[->>+>+<<<]>>>[-<<<+>>>][-]>[-]<[-]<[
->+<]+>>+<[->[-<<->>]<][-]>[-]<[-]<<[-]>[-<+>>+<]>[-<+>][-]>[-]<[-]<<[->>+<<]+>>
>+<[->[-<<<->>>]<][-]>[-]<<<[<<<<<+>>>>>-][-]>[-]<<<<<[-]>[-]>[-]>[-]<<<[-]>[-]<
[-]<<<<<<<<[->>>>>>>>+>+<<<<<<<<<]>>>>>>>>>[-<<<<<<<<<+>>>>>>>>>][-]<[-<<<<<<<<<
<<<+>>>>>>>>>>>>][-]>[-]<[-]<[->+>+<<]>>[-<<+>>][-]<[-<<<<<<<<<<<<+>>>>>>>>>>>>]
[-]<<[-]>[-]<[-]<<<<<<<<<[-]<<<<<<[->>>>>>+>>>>>>>>>+<<<<<<<<<<<<<<<]>>>>>>>>>>>
>>>>[-<<<<<<<<<<<<<<<+>>>>>>>>>>>>>>>][-]<<<<<<<<[-]<<<<<<[->>>>>>+>>>>>>>>+<<<<
<<<<<<<<<<]>>>>>>>>>>>>>>[-<<<<<<<<<<<<<<+>>>>>>>>>>>>>>][-]>[-]>[-]<<[-]<<<<<<<
<[->>>>>>>>+>>+<<<<<<<<<<]>>>>>>>>>>[-<<<<<<<<<<+>>>>>>>>>>][-]>[-]>[-]>[-]>[-]<
<<<[-]<<[->>+>>>>+<<<<<<]>>>>>>[-<<<<<<+>>>>>>][-]<<<[-]<<<<<<<[->>>>>>>+>>>+<<<
<<<<<<<]>>>>>>>>>>[-<<<<<<<<<<+>>>>>>>>>>][-]<<[-]<<[->>+>>+<<<<]>>>>[-<<<<+>>>>
][-]>[-]>[-]<<[-]<<[->>+<<]>>>>>[-]>[-]<[-]<<<[->>>+<<<]+>>>>+<[->[-<<<<->>>>]<]
[-]>[-]<[-]>[-]<[-]<<<[->>>+<<<]+>>>>+<[->[-<<<<->>>>]<][-]>[-]<[-]<<[-]<<<<[->>
>>+>>+<<<<<<]>>>>>>[-<<<<<<+>>>>>>][-]>[-]<[-]<<[->>+<<]+>>>+<[->[-<<<->>>]<][-]
>[-]<[-]>[-]<[-]<<[->>+<<]+>>>+<[->[-<<<->>>]<][-]>[-]<<<<[->>[-]<[->+<]<]<<[-]>
>>>[-<<<<+>>>>]<<[-]>[-]>[-]<<[-]>[-]<[-]<<[->>+>+<<<]>>>[-<<<+>>>][-]>[-]<[-]<[
->+<]+>>+<[->[-<<->>]<][-]>[-]<[-]>[-]<[-]<[->+<]+>>+<[->[-<<->>]<][-]>[-]<<[<<<
<->->>>>[-]<<<[-]<<[->>+>>>+<<<<<]>>>>>[-<<<<<+>>>>>][-]>[-]>[-]<<[-]<<<[->>>+<<
<]>>>>>>[-]>[-]<[-]<<<[->>>+<<<]+>>>>+<[->[-<<<<->>>>]<][-]>[-]<[-]>[-]<[-]<<<[-
>>>+<<<]+>>>>+<[->[-<<<<->>>>]<][-]>[-]<[-]<<[-]<<<<<[->>>>>+>>+<<<<<<<]>>>>>>>[
-<<<<<<<+>>>>>>>][-]>[-]<[-]<<[->>+<<]+>>>+<[->[-<<<->>>]<][-]>[-]<[-]>[-]<[-]<<
[->>+<<]+>>>+<[->[-<<<->>>]<][-]>[-]<<<<[->>[-]<[->+<]<]<<<[-]>>>>>[-<<<<<+>>>>>
]<<[-]>[-]>[-]<<[-]<[-]<<[->>+>+<<<]>>>[-<<<+>>>][-]>[-]<[-]<[->+<]+>>+<[->[-<<-
>>]<][-]>[-]<[-]>[-]<[-]<[->+<]+>>+<[->[-<<->>]<][-]>[-]<<][-]<<<<<<[-]>>>>>>[-]
<[-]<<<[->>>+>+<<<<]>>>>[-<<<<+>>>>][-]>[-]<[-]<[->+<]+>>+<[->[-<<->>]<][-]>[-]<
[-]>[-]>[-]<<[-]<[->+<]>>>>[-]>[-]<[-]<<<[->>>+<<<]+>>>>+<[->[-<<<<->>>>]<][-]>[
-]<[-]>[-]<[-]<<<[->>>+<<<]+>>>>+<[->[-<<<<->>>>]<][-]>[-]<[-]<<[-]<<<<[->>>>+>>
+<<<<<<]>>>>>>[-<<<<<<+>>>>>>][-]>[-]<[-]<<[->>+<<]+>>>+<[->[-<<<->>>]<][-]>[-]<
[-]>[-]<[-]<<[->>+<<]+>>>+<[->[-<<<->>>]<][-]>[-]<<<<[->>[-]<[->+<]<]<[-]>>>[-<<
<+>>>]<<[-]>[-]>[-]<<[-]>[-]>[-]<[-]<<[->>+>+<<<]>>>[-<<<+>>>][-]>[-]<[-]<[->+<]
+>>+<[->[-<<->>]<][-]>[-]<[-]<<[-]>[-<+>>+<]>[-<+>][-]>[-]<[-]<<[->>+<<]+>>>+<[-
>[-<<<->>>]<][-]>[-]<<<[<<<<<<+>>>>>>-][-]>[-]<<<<<[-]>[-]>[-]>[-]<<<[-]<[-]<<<<
<<<<<[->>>>>>>>>+>+<<<<<<<<<<]>>>>>>>>>>[-<<<<<<<<<<+>>>>>>>>>>][-]>[-]<[-]<<<<<
<[->>>>>>+>+<<<<<<<]>>>>>>>[-<<<<<<<+>>>>>>>][-]<[-<->][-]>[-]<[-]<[->+<]+>>+<[-
>[-<<->>]<][-]>[-]<[-]>[-]>[-]<[-]<<[->>+>+<<<]>>>[-<<<+>>>][-]>[-]<[-]<[->+<]+>
>+<[->[-<<->>]<][-]>[-]<[-]<<[-]>[-<+>>+<]>[-<+>][-]>[-]<[-]<<[->>+<<]+>>>+<[->[
-<<<->>>]<][-]>[-]<<<[>>[-]<<<<[-]<<<<<<<<<[->>>>>>>>>+>>>>+<<<<<<<<<<<<<]>>>>>>
>>>>>>>[-<<<<<<<<<<<<<+>>>>>>>>>>>>>][-]>[-]>[-]>[-]>[-]<<<<[-]<<<<[->>>>+>>>>+<
<<<<<<<]>>>>>>>>[-<<<<<<<<+>>>>>>>>][-]<<<[-]<<<<<<<<<<[->>>>>>>>>>+>>>+<<<<<<<<
<<<<<]>>>>>>>>>>>>>[-<<<<<<<<<<<<<+>>>>>>>>>>>>>][-]<<[-]<<[->>+>>+<<<<]>>>>[-<<
<<+>>>>][-]>[-]>[-]<<[-]<<[->>+<<]>>>>>[-]>[-]<[-]<<<[->>>+<<<]+>>>>+<[->[-<<<<-
>>>>]<][-]>[-]<[-]>[-]<[-]<<<[->>>+<<<]+>>>>+<[->[-<<<<->>>>]<][-]>[-]<[-]<<[-]<
<<<[->>>>+>>+<<<<<<]>>>>>>[-<<<<<<+>>>>>>][-]>[-]<[-]<<[->>+<<]+>>>+<[->[-<<<->>
>]<][-]>[-]<[-]>[-]<[-]<<[->>+<<]+>>>+<[->[-<<<->>>]<][-]>[-]<<<<[->>[-]<[->+<]<
]<<[-]>>>>[-<<<<+>>>>]<<[-]>[-]>[-]<<[-]>[-]<[-]<<[->>+>+<<<]>>>[-<<<+>>>][-]>[-
]<[-]<[->+<]+>>+<[->[-<<->>]<][-]>[-]<[-]>[-]<[-]<[->+<]+>>+<[->[-<<->>]<][-]>[-
]<<[<<<<->->>>>[-]<<<[-]<<[->>+>>>+<<<<<]>>>>>[-<<<<<+>>>>>][-]>[-]>[-]<<[-]<<<[
->>>+<<<]>>>>>>[-]>[-]<[-]<<<[->>>+<<<]+>>>>+<[->[-<<<<->>>>]<][-]>[-]<[-]>[-]<[
-]<<<[->>>+<<<]+>>>>+<[->[-<<<<->>>>]<][-]>[-]<[-]<<[-]<<<<<[->>>>>+>>+<<<<<<<]>
>>>>>>[-<<<<<<<+>>>>>>>][-]>[-]<[-]<<[->>+<<]+>>>+<[->[-<<<->>>]<][-]>[-]<[-]>[-
]<[-]<<[->>+<<]+>>>+<[->[-<<<->>>]<][-]>[-]<<<<[->>[-]<[->+<]<]<<<[-]>>>>>[-<<<<
<+>>>>>]<<[-]>[-]>[-]<<[-]<[-]<<[->>+>+<<<]>>>[-<<<+>>>][-]>[-]<[-]<[->+<]+>>+<[
->[-<<->>]<][-]>[-]<[-]>[-]<[-]<[->+<]+>>+<[->[-<<->>]<][-]>[-]<<][-]<<<<<<<<[-]
>>>>>>>>[-]<[-]<<<[->>>+>+<<<<]>>>>[-<<<<+>>>>][-]>[-]<[-]<[->+<]+>>+<[->[-<<->>
]<][-]>[-]<[-]>[-]>[-]<<[-]<[->+<]>>>>[-]>[-]<[-]<<<[->>>+<<<]+>>>>+<[->[-<<<<->
>>>]<][-]>[-]<[-]>[-]<[-]<<<[->>>+<<<]+>>>>+<[->[-<<<<->>>>]<][-]>[-]<[-]<<[-]<<
<<[->>>>+>>+<<<<<<]>>>>>>[-<<<<<<+>>>>>>][-]>[-]<[-]<<[->>+<<]+>>>+<[->[-<<<->>>
]<][-]>[-]<[-]>[-]<[-]<<[->>+<<]+>>>+<[->[-<<<->>>]<][-]>[-]<<<<[->>[-]<[->+<]<]
<[-]>>>[-<<<+>>>]<<[-]>[-]>[-]<<[-]>[-]>[-]<[-]<<[->>+>+<<<]>>>[-<<<+>>>][-]>[-]
<[-]<[->+<]+>>+<[->[-<<->>]<][-]>[-]<[-]<<[-]>[-<+>>+<]>[-<+>][-]>[-]<[-]<<[->>+
<<]+>>>+<[->[-<<<->>>]<][-]>[-]<<<[<<<<<<<<+>>>>>>>>-][-]>[-]<<<<<[-]>[-]>[-]>[-
]<<<<<-][-]>[-]<[-]>[-]>[-]<[-]<<<[->>>+>+<<<<]>>>>[-<<<<+>>>>][-]>[-]<[-]<[->+<
]+>>+<[->[-<<->>]<][-]>[-]<[-]<<[-]>[-<+>>+<]>[-<+>][-]>[-]<[-]<<[->>+<<]+>>>+<[
->[-<<<->>>]<][-]>[-]<<<[<<<<<<<<<<<[-]+>[-]>>>>>>>>>>-]>[<<<<<<<<<<<<[-]>[-]>>>
>>>>>>>>-]<[-]>[-]<<<[-]>[-]<[-]>[-]>[-]<<[-]<<<<<<<<<[->>>>>>>>>+>>+<<<<<<<<<<<
]>>>>>>>>>>>[-<<<<<<<<<<<+>>>>>>>>>>>][-]>[-]<[-]<<[->>+<<]+>>>+<[->[-<<<->>>]<]
[-]>[-]<[-]<[-]<<<<<<<<<[->>>>>>>>>+>+<<<<<<<<<<]>>>>>>>>>>[-<<<<<<<<<<+>>>>>>>>
>>][-]>[-]<[-]<[->+<]+>>+<[->[-<<->>]<][-]>[-]<[-]>[-]>[-]<<[-]<<[->>+<<]>>>>>[-
]>[-]<[-]<<<[->>>+<<<]+>>>>+<[->[-<<<<->>>>]<][-]>[-]<[-]>[-]<[-]<<<[->>>+<<<]+>
>>>+<[->[-<<<<->>>>]<][-]>[-]<[-]<<[-]<<[->>+>>+<<<<]>>>>[-<<<<+>>>>][-]>[-]<[-]
<<[->>+<<]+>>>+<[->[-<<<->>>]<][-]>[-]<[-]>[-]<[-]<<[->>+<<]+>>>+<[->[-<<<->>>]<
][-]>[-]<<<<[->>[-]<[->+<]<]<<[-]>>>>[-<<<<+>>>>]<<[-]>[-]>[-]<<[-]>[-]>[-]<[-]<
<<[->>>+>+<<<<]>>>>[-<<<<+>>>>][-]>[-]<[-]<[->+<]+>>+<[->[-<<->>]<][-]>[-]<[-]<<
[-]>[-<+>>+<]>[-<+>][-]>[-]<[-]<<[->>+<<]+>>>+<[->[-<<<->>>]<][-]>[-]<<<[<<<<<<<
<<<<[-]+>[-]>>>>>>>>>>-]>[<<<<<<<<<<<<[-]>[-]>>>>>>>>>>>-]<[-]>[-]<<<[-]>[-]<[-]
<[-]<<<<<<<<[->>>>>>>>+>+<<<<<<<<<]>>>>>>>>>[-<<<<<<<<<+>>>>>>>>>][-]>[-]<[-]<[-
>+<]+>>+<[->[-<<->>]<][-]>[-]<[-]>[-]<[-]<[->+<]+>>+<[->[-<<->>]<][-]>[-]<<][-]<
<<<<<<<<<<<<<[-]>>>>[-<<<<+>>>>]<<<[-]>>>>[-<<<<+>>>>]>>>>>>>-]<<<<<<<<[-]>[-]>[
-]>[-]>[-]>[-]>[-]>[-]>[-]>[-]<<<<<<<<<<<<<
END

# run shr16(a,b)
for my $A (0, 1, 2, 4, 8, 16, 32, 64, 128, 255, 256, 511) {
	for my $B (1, 2, 4) {
		spew("$test.in", <<END);
		alloc_cell16(A)
		alloc_cell16(B)
		set16(A, $A)
		set16(B, $B)
		shr16(A, B)
		>(B+1)
END
		my $R = sprintf("%3d", $A >> $B);
		my $Rlo = sprintf("%3d", $R & 0xFF);
		my $Rhi = sprintf("%3d", ($R >> 8) & 0xFF);
		my $Blo = sprintf("%3d", $B & 0xFF);
		my $Bhi = sprintf("%3d", ($B >> 8) & 0xFF);
		capture_ok("bfpp $test.in | bf -D", <<END);
Tape:$Rlo $Rhi $Blo $Bhi 
                 ^^^ (ptr=3)

END
	}
}

unlink_testfiles;
done_testing;
